{% extends '../base.html' %}
{% load static %}
{% block title %} Wishlist{% endblock %}
{% block content %}
<!-- Wishlist Area Start -->
<section class="wishlist-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <!-- Dashboard-Nav  Start-->
                <div class="dashboard-nav">
                    <ul class="list-inline">
                        <li class="list-inline-item"><a href="{% url 'customers:settings-user' %}">Account
                                settings</a></li>
                        <li class="list-inline-item"><a href="{% url 'payment:add-address' %}">Billing information</a></li>
                        <li class="list-inline-item"><a href="#" class="active">My wishlist</a></li>
                        <li class="list-inline-item"><a href="{% url 'cart:cart_items' %}">My cart</a></li>
                        <li class="list-inline-item"><a href="{% url 'orders:view-orders' %}">Order</a></li>
                        <li class="list-inline-item"><a href="{% url 'customers:logout' %}" class="mr-0">Log-out</a></li>
                    </ul>
                </div>
                <!-- Dashboard-Nav  End-->
            </div>
        </div>
        <div class="rows">
            <!-- Wishlist Item Start -->
            <div class="cart-items">
                <div class="header">
                    <div class="image">
                        Image
                    </div>
                    <div class="name">
                        Name
                    </div>
                    <div class="price">
                        Prices
                    </div>
                    <div class="rating">
                        Rating
                    </div>
                    <div class="info">
                        Info
                    </div>
                </div>
                <div class="body">
                    {% if page_obj.count == 0 %}
                    <div class="col-12">Your wishlist is empty <a href="{% url 'shop:shop_home' %}">Shop</a></div>
                    {% else %}
                    {% for product in page_obj %}
                    <div class="item">
                        <div class="image">
                            <img src="{{ product.thumbnail.url }}">
                        </div>
                        <div class="name">
                            <div class="name-text">
                                <p> {{ product.title }}</p>
                            </div>
                            <div class="button">
                                <a class="btn btn-secondary"  href="{% url 'customers:add_wishlist' product.id %}">Remove</a>
                                <button class="btn btn-primary add-to-cart"  value="{{ product.id }}" id="{{product.attributes.first.id }}">Add to cart</button>
                            </div>
                        </div>
                        <div class="price">
                            <span>Rs {{ product.attributes.first.price }} </span> <br> Rs <del>{{ product.mrp_price }}</del>
                        </div>
                        <div class="rating">
                            <li>
                            {% for star in product.get_avg_rating|ljust:product.get_avg_rating %}
                                <i class="fas fa-star"></i>
                            {% endfor %}
                            </li>
                            <small><li>{{product.get_avg_rating}}({{product.count_review}} Rating)</li></small>
                        </div>
                        <div class="info">
                            <div class="size">
                                <div class="product-pricelist-selector-color">
                                    <h6>Colors</h6>
                                    <div class="colors" id="colors">
                                        <span class="border border-5 py-3 px-3" style="background-color: {{ product.attributes.first.color.color_code }}"></span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            <!-- Wishlist Item End -->
        </div>
    </div>
</section>
<!-- Pagination Start -->
<section class="pagination">
    <div class="container">
        <div class="d-flex justify-content-center">

            <ul class="pagination my-1">
              {% if page_obj.has_previous %}
              <li class="page-item" aria-current="page">
                <a class="page-link" href="?page=1">First</a>
              </li>
              <li class="page-item" aria-current="page">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
              </li>
              {% endif %}
    
              {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
              <li class="page-item active"><a href="?page={{ num }}" class="page-link">{{ num }}</a>
              </li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
              <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
              {% endif %}
              {% endfor %}
    
              {% if page_obj.has_next %}
              <li class="page-item" aria-current="page">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
              </li>
              <li class="page-item" aria-current="page">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages}}">Last</a>
              </li>
              {% endif %}
    
            </ul>
            
          </div>
    </div>
</section>

<!-- Pagination End -->
<script>
    [...document.getElementsByClassName("add-to-cart")].forEach(function(e){
    e.addEventListener("click", function() {
        console.log("hi")
        
        product_id= Number(this.getAttribute('value'))
        variation_id = Number(this.getAttribute('id'))

        console.log(variation_id);
            
        const formData = new FormData();
        //console.log(name);
        formData.append('productid', product_id);
        formData.append('productqty', 1);
        formData.append('variationid', variation_id);
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');
        console.log(formData);
        fetch('{% url "cart:cart_add" %}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            console.log(data)
            let quandity = Number(document.getElementById("cart-id").innerHTML);
            quandity = quandity+data.qty;
            document.getElementById("cart-id").innerHTML = quandity
            console.log('Success:', data);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    })
  });
</script>
{% endblock %}